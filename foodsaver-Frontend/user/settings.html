<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Food Saver | Settings</title>
  <link rel="stylesheet" href="../css/dashboard.css" />
</head>
<body>

<script>
/* üîê USER ACCESS GUARD */
const token = localStorage.getItem("token");
const role  = localStorage.getItem("role");
const email = localStorage.getItem("email");

if (!token || role?.toUpperCase() !== "USER") {
  localStorage.clear();
  window.location.href = "../index.html";
}
</script>

<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <button class="sidebar-close" onclick="toggleSidebar()">‚úï</button>   
    <h2 class="logo">FoodSaver</h2>

    <nav>
      <a data-page="user-dashboard.html">Dashboard</a>
      <a data-page="user-surplus.html">availableFood</a>
      <a class="active">Settings</a>
      <a id="logoutBtn">Logout</a>
    </nav>

    <div class="sidebar-footer">Zero Waste üå±</div>
  </aside>

  <!-- MAIN -->
  <main class="content">

    <!-- TOP BAR -->
   <header class="topbar">
  <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>

  <h1 class="top-title">Settings</h1>

  <div class="top-right">
    <button id="themeToggle" class="outline-btn">üåô</button>
    <div class="avatar">NGO</div>
  </div>
</header>
    <!-- ORGANIZATION PROFILE -->
    <section class="panel">
      <h3>Organization Profile</h3>

      <div class="form-grid">
        <div>
          <label>Organization Name</label>
          <input type="text" id="orgName">
        </div>

        <div>
          <label>Contact Number</label>
          <input type="text" id="contact">
        </div>
      </div>

      <button class="primary-btn" style="margin-top:16px;" onclick="saveSettings()">
        Save Changes
      </button>

      <p id="saveMsg" style="display:none;color:green;margin-top:10px;">
        Settings saved successfully
      </p>
    </section>

    <!-- PREFERENCES -->
    <section class="panel">
      <h3>Preferences</h3>

      <div class="toggle">
        <input type="checkbox" id="emailNotif">
        <span>Enable email notifications</span>
      </div>

      <div class="toggle">
        <input type="checkbox" id="expiryNotif">
        <span>Notify on expiring food</span>
      </div>

      <div class="toggle">
        <input type="checkbox" id="weeklyReport">
        <span>Enable weekly summary reports</span>
      </div>
    </section>

  </main>
</div>

<!-- ‚úÖ chatbot.js (already exists in your project) -->
<script src="../js/chatbot.js"></script>
<script src="../js/app.js"></script>

<script>
/* ===== BASE URL (RENDER BACKEND) ===== */
const BASE_URL = "https://foodsaver-backend-d964.onrender.com";

/* ===== SETTINGS API ===== */
const SETTINGS_API = `${BASE_URL}/api/settings`;

/* ===== AUTH HEADERS ===== */
function authHeaders() {
  return {
    "Content-Type": "application/json",
    "Authorization": "Bearer " + token
  };
}

/* ===== LOAD SETTINGS ===== */
fetch(`${SETTINGS_API}?email=${email}`, {
  headers: authHeaders()
})
.then(res => res.ok ? res.json() : null)
.then(data => {
  if (!data) return;

  orgName.value = data.organizationName || "";
  contact.value = data.contactNumber || "";
  emailNotif.checked = !!data.emailNotifications;
  expiryNotif.checked = !!data.expiryNotifications;
  weeklyReport.checked = !!data.weeklyReports;
});
</script>

<script>
/* ===== SAVE SETTINGS ===== */
function saveSettings() {
  fetch(`${SETTINGS_API}?email=${email}`, {
    method: "PUT",
    headers: authHeaders(),
    body: JSON.stringify({
      organizationName: orgName.value,
      contactNumber: contact.value,
      emailNotifications: emailNotif.checked,
      expiryNotifications: expiryNotif.checked,
      weeklyReports: weeklyReport.checked
    })
  })
  .then(res => {
    if (!res.ok) return;
    saveMsg.style.display = "block";
    setTimeout(() => saveMsg.style.display = "none", 2500);
  });
}
</script>

<script>
function toggleSidebar() {
  document.querySelector(".sidebar").classList.toggle("open");
}
</script>  

<script>
/* LOGOUT */
logoutBtn.onclick = () => {
  localStorage.clear();
  window.location.href = "../index.html";
};
</script>

</body>
</html>
















